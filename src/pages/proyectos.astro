---
import Layout from "../layouts/Layout.astro";
import Footer from "../components/Footer.astro";
import FinalCTA from "../components/FinalCTA.astro";
import { getCollection, getEntry } from "astro:content";
import { MapPin } from "lucide-react";
import type { WithContext, CollectionPage } from "schema-dts";

const projects = await getCollection("projects");
const business = await getEntry("business", "global");
const { siteName, city, niche } = business?.data || {
    siteName: "Nombre Negocio",
    city: "Ciudad",
    niche: "Servicio",
};

const gallerySchema: WithContext<CollectionPage> = {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    name: `Galería de Trabajos - ${siteName}`,
    description: `Portafolio de trabajos de ${niche} en ${city}.`,
};
---

<Layout
    title={`Nuestros Trabajos | ${siteName}`}
    description={`Galería de proyectos de ${niche} en ${city}.`}
    schema={gallerySchema}
>
    <section class="relative py-20 bg-secondary border-b border-heading/5">
        <div class="container mx-auto px-4 text-center">
            <h1
                class="text-5xl md:text-7xl font-heading font-bold text-heading mb-6"
            >
                NUESTROS <span
                    class="text-transparent bg-clip-text"
                    style="background-image: var(--theme-gradient);"
                    >PROYECTOS</span
                >
            </h1>
            <p class="text-xl text-body max-w-2xl mx-auto">
                Una imagen vale más que mil palabras. Descubre la calidad de
                nuestros acabados en {city} y provincia.
            </p>
        </div>
    </section>

    <section class="py-20 bg-surface/30">
        <div class="container mx-auto px-4">
            {
                projects.length > 0 ? (
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                        {projects.map((project) => (
                            <div class="group relative rounded-lg overflow-hidden bg-surface shadow-lg border border-heading/10 hover:border-primary/50 transition-all hover:shadow-2xl hover:shadow-primary/10 aspect-[4/3]">
                                <div class="absolute inset-0 bg-surface/50 flex items-center justify-center text-body group-hover:scale-105 transition-transform duration-700">
                                    {/* NOTA: Si usas imágenes reales, descomenta esto:
                                <img src={project.data.image} alt={project.data.title} class="w-full h-full object-cover" /> 
                             */}
                                    <span class="text-sm uppercase tracking-widest font-bold">
                                        Foto: {project.data.title}
                                    </span>
                                </div>

                                <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent opacity-60 group-hover:opacity-90 transition-opacity" />

                                <div class="absolute bottom-0 left-0 p-6 translate-y-2 group-hover:translate-y-0 transition-transform w-full">
                                    <span class="inline-flex items-center gap-1 text-primary text-xs font-bold uppercase tracking-wider mb-2 bg-black/50 px-2 py-1 rounded backdrop-blur-sm border border-white/10">
                                        <MapPin className="w-3 h-3" />{" "}
                                        {project.data.locationTag}
                                    </span>
                                    <h3 class="text-2xl font-heading font-bold text-white leading-tight">
                                        {project.data.title}
                                    </h3>
                                </div>
                            </div>
                        ))}
                    </div>
                ) : (
                    // ESTADO VACÍO
                    <div class="text-center py-20 border-2 border-dashed border-heading/20 rounded-xl bg-surface/30">
                        <p class="text-body text-lg mb-4">
                            Estamos actualizando nuestra galería de proyectos de{" "}
                            {niche}.
                        </p>
                        <a
                            href="/contacto/"
                            class="text-primary font-bold hover:underline"
                        >
                            Solicitar fotos de trabajos recientes
                        </a>
                    </div>
                )
            }
        </div>
    </section>

    <FinalCTA />
    <Footer />
</Layout>
