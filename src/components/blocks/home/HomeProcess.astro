---
import { marked } from "marked";

interface Props {
    process: {
        title?: string;
        description?: string;
        steps: {
            title: string;
            description: string;
        }[];
    };
    bgClass?: string;
}

const { process, bgClass = "bg-surface" } = Astro.props;

// Determine card background based on section background for contrast
const cardBgClass = bgClass === "bg-secondary" ? "bg-surface" : "bg-secondary";
---

{
    process && process.steps && process.steps.length > 0 && (
        <section class={`py-20 ${bgClass} relative overflow-hidden`}>
            <div class="container mx-auto px-4">
                <div class="text-center mb-16 max-w-3xl mx-auto">
                    {process.title && (
                        <h2 class="text-4xl font-heading font-bold text-heading mb-4">
                            {process.title}
                        </h2>
                    )}
                    <div class="w-24 h-1 bg-primary mx-auto mb-6" />
                    {process.description && (
                        <p class="text-body text-lg" set:html={marked.parseInline(process.description)} />
                    )}
                </div>

                <div class="relative max-w-5xl mx-auto">
                    {/* Vertical Line (Desktop) */}
                    <div class="hidden md:block absolute left-1/2 top-0 bottom-0 w-0.5 bg-gradient-to-b from-primary/20 via-primary/50 to-primary/20 -translate-x-1/2" />

                    <div class="space-y-12 md:space-y-0">
                        {process.steps.map((step, index) => (
                            <div
                                class={`relative flex items-center ${index % 2 === 0 ? "md:flex-row" : "md:flex-row-reverse"}`}
                            >
                                {/* Content Side */}
                                <div class="flex-1 md:w-1/2 p-6">
                                    <div
                                        class={`${cardBgClass} p-8 rounded-2xl shadow-lg border border-heading/5 relative hover:-translate-y-1 transition-transform duration-300 ${index % 2 === 0 ? "md:text-right" : "md:text-left"}`}
                                    >
                                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-primary to-accent rounded-t-2xl opacity-50" />
                                        <h3 class="text-2xl font-bold text-heading mb-3" set:html={marked.parseInline(step.title || (step as any).name || '')} />
                                        <p class="text-body leading-relaxed" set:html={marked.parseInline(step.description || '')} />
                                    </div>
                                </div>

                                {/* Center Circle */}
                                <div
                                    class={`absolute left-0 md:left-1/2 w-10 h-10 rounded-full ${cardBgClass} border-4 border-primary flex items-center justify-center z-10 -translate-x-1/2 md:-translate-x-1/2 shadow-md`}
                                >
                                    <span class="font-bold text-primary text-sm">
                                        {index + 1}
                                    </span>
                                </div>

                                {/* Empty Side (Desktop) */}
                                <div class="hidden md:block flex-1 md:w-1/2" />

                                {/* Mobile Line Fix: Add padding to content to avoid overlap with absolute circle if needed, but flex layout handles it mostly. 
                    Actually for mobile, the circle is absolute left-0. We need to push content.
                */}
                            </div>
                        ))}
                    </div>
                </div>
            </div>
        </section>
    )
}

<style>
    /* Mobile adjustments */
    @media (max-width: 768px) {
        .container {
            padding-left: 2rem; /* Make space for the timeline line/circles if we want them on the left */
        }
        /* Override the absolute positioning for mobile to be a simple left-aligned timeline */
    }
</style>
