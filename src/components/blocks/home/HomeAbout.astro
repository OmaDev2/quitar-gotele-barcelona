---
import { Image } from "astro:assets";
import defaultAboutImage from "../../../assets/images/about-us.png";
import { CheckCircle, ArrowRight } from "lucide-react";

const { aboutSection, bgClass = "bg-secondary" } = Astro.props;
if (!aboutSection) return null;

const isDefaultImage =
    !aboutSection.image ||
    aboutSection.image === "/images/home/about-placeholder.jpg" ||
    aboutSection.image === "";
const aboutImage = aboutSection.image || "/images/home/about-placeholder.jpg";
---

<section class={`py-20 ${bgClass} border-b border-heading/10`}>
    <div class="container mx-auto px-4">
        <div class="grid lg:grid-cols-2 gap-12 items-center">
            <div class="relative">
                <div
                    class="relative rounded-2xl overflow-hidden shadow-2xl aspect-[4/3]"
                >
                    {
                        isDefaultImage ? (
                            <Image
                                src={defaultAboutImage}
                                alt={aboutSection.title || "Sobre Nosotros"}
                                class="w-full h-full object-cover"
                            />
                        ) : (
                            <img
                                src={aboutImage}
                                alt={aboutSection.title || "Sobre Nosotros"}
                                class="w-full h-full object-cover"
                            />
                        )
                    }
                    <div
                        class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"
                    >
                    </div>
                </div>
                {
                    aboutSection.yearsExperience && (
                        <div class="absolute -bottom-6 -right-6 bg-primary text-white p-4 rounded-xl shadow-xl border-4 border-secondary z-10 flex flex-col items-center justify-center w-28 h-28 lg:w-32 lg:h-32">
                            <span class="text-3xl lg:text-4xl font-bold block">
                                {aboutSection.yearsExperience.replace(
                                    /\D/g,
                                    "",
                                )}
                                +
                            </span>
                            <span class="text-xs uppercase tracking-wider font-bold text-center">
                                AÑOS
                            </span>
                        </div>
                    )
                }
            </div>
            <div>
                <h2
                    class="text-4xl lg:text-5xl font-heading font-bold text-heading mb-8"
                >
                    {
                        aboutSection.title ||
                            "⚠️ Configura el Título en CMS (Home > Sobre Nosotros)"
                    }
                </h2>
                <div class="prose prose-invert prose-lg text-body mb-8">
                    {
                        aboutSection.description &&
                            aboutSection.description
                                .split("\n")
                                .map(
                                    (p: string) =>
                                        p.trim() && (
                                            <p
                                                class="mb-4"
                                                set:html={p.replace(
                                                    /\*\*(.*?)\*\*/g,
                                                    '<strong class="text-heading">$1</strong>',
                                                )}
                                            />
                                        ),
                                )
                    }
                </div>
                {
                    aboutSection.features && (
                        <div class="space-y-6 mb-10">
                            {aboutSection.features.map((feature: any) => (
                                <div class="flex items-start gap-4">
                                    <div class="mt-1 flex-shrink-0">
                                        <CheckCircle className="w-6 h-6 text-primary" />
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold text-heading mb-1">
                                            {feature.title || feature.name}
                                        </h3>
                                        <p class="text-body text-sm">
                                            {feature.description}
                                        </p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )
                }
                {
                    aboutSection.buttonText && (
                        <a
                            href={aboutSection.buttonLink || "/nosotros"}
                            class="inline-flex items-center px-8 py-4 border border-primary text-primary font-bold rounded hover:bg-primary hover:text-white transition-all group"
                        >
                            {aboutSection.buttonText}{" "}
                            <ArrowRight className="w-5 h-5 ml-2 transition-transform group-hover:translate-x-1" />
                        </a>
                    )
                }
            </div>
        </div>
    </div>
</section>
