---
import ServiceAreas from "./ServiceAreas.astro";
import { Phone, Mail, MapPin, Facebook, Instagram } from "lucide-react";
import { getEntry } from "astro:content";
import { getSettings } from "@/lib/settings";
import { generateTelUrl } from "@/utils/contact";

// 1. Recuperar configuración unificada
const settings = await getSettings();
const { siteName, phone, email, address, city, niche, facebook, instagram } =
    settings;

// 2. Recuperar configuración específica del Footer
const footerConfig = await getEntry("footer", "main");
const footerData = footerConfig?.data || {};

// Valores por defecto si no se configuran en Keystatic
const description =
    footerData.description ||
    `⚠️ Configura esta descripción en el CMS (Footer > Descripción)`;
const disclaimer =
    footerData.disclaimer ||
    `⚠️ Configura este texto legal en el CMS (Footer > Disclaimer)`;
const footerLinks =
    footerData.footerLinks && footerData.footerLinks.length > 0
        ? footerData.footerLinks
        : [
              { label: "Aviso Legal", url: "/aviso-legal/" },
              { label: "Privacidad", url: "/privacidad/" },
              { label: "Cookies", url: "/cookies/" },
          ];
---

<footer class="bg-[#050911] text-white overflow-hidden">
    {/* Borde superior naranja grueso */}
    <div class="h-1.5 bg-primary w-full"></div>

    <div class="container mx-auto px-4 pt-16 pb-8">
        <div class="grid grid-cols-1 md:grid-cols-12 gap-12 mb-16">
            {/* COLUMNA 1: LOGO E INFO (Span 3) */}
            <div class="md:col-span-3 space-y-6">
                <div>
                    <div
                        class="text-2xl font-heading font-black text-white mb-4 uppercase tracking-tighter"
                    >
                        {siteName.split(" ").slice(0, -1).join("")}<span
                            class="text-primary"
                            >{siteName.split(" ").slice(-1)}</span
                        >
                    </div>
                    <p class="text-gray-400 text-sm leading-relaxed max-w-xs">
                        {description}
                    </p>
                </div>

                {/* Redes Sociales */}
                {
                    (facebook || instagram) && (
                        <div class="flex gap-3">
                            {facebook && (
                                <a
                                    href={facebook}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="w-9 h-9 rounded bg-white/5 flex items-center justify-center border border-white/10 text-gray-400 hover:text-primary hover:border-primary transition-all"
                                >
                                    <Facebook className="w-4 h-4" />
                                </a>
                            )}
                            {instagram && (
                                <a
                                    href={instagram}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="w-9 h-9 rounded bg-white/5 flex items-center justify-center border border-white/10 text-gray-400 hover:text-primary hover:border-primary transition-all"
                                >
                                    <Instagram className="w-4 h-4" />
                                </a>
                            )}
                        </div>
                    )
                }
            </div>

            {/* COLUMNA 2: ENLACES ÚTILES (Span 2) */}
            <div class="md:col-span-2">
                <div
                    class="text-white font-bold mb-8 uppercase tracking-widest text-sm"
                >
                    Enlaces
                </div>
                <ul class="space-y-3 text-gray-300 text-sm">
                    <li>
                        <a href="/" class="hover:text-primary transition-colors">
                            Inicio
                        </a>
                    </li>
                    <li>
                        <a href="/contacto/" class="hover:text-primary transition-colors">
                            Contacto
                        </a>
                    </li>
                    <li>
                        <a href="/nosotros/" class="hover:text-primary transition-colors">
                            Nosotros
                        </a>
                    </li>
                    <li>
                        <a href="/zonas/" class="hover:text-primary transition-colors">
                            Zonas
                        </a>
                    </li>
                    <li>
                        <a href="/blog/" class="hover:text-primary transition-colors">
                            Blog
                        </a>
                    </li>
                    <li>
                        <a href="/proyectos/" class="hover:text-primary transition-colors">
                            Proyectos
                        </a>
                    </li>
                </ul>
            </div>

            {/* COLUMNA 3: CONTACTO (Span 3) */}
            <div class="md:col-span-3">
                <div
                    class="text-white font-bold mb-8 uppercase tracking-widest text-sm"
                >
                    Contacto
                </div>
                <ul class="space-y-5 text-gray-300 text-sm">
                    <li class="flex items-center gap-4 group">
                        <div
                            class="p-2 rounded bg-white/5 text-primary group-hover:bg-primary group-hover:text-white transition-all"
                        >
                            <Phone className="w-4 h-4" />
                        </div>
                        <a
                            href={generateTelUrl(phone)}
                            class="hover:text-primary transition-colors font-medium"
                        >
                            {phone}
                        </a>
                    </li>
                    <li class="flex items-center gap-4 group">
                        <div
                            class="p-2 rounded bg-white/5 text-primary group-hover:bg-primary group-hover:text-white transition-all"
                        >
                            <Mail className="w-4 h-4" />
                        </div>
                        <a
                            href={`mailto:${email}`}
                            class="hover:text-primary transition-colors break-all font-medium"
                        >
                            {email}
                        </a>
                    </li>
                    {
                        address && (
                            <li class="flex items-center gap-4 group">
                                <div class="p-2 rounded bg-white/5 text-primary group-hover:bg-primary group-hover:text-white transition-all">
                                    <MapPin className="w-4 h-4" />
                                </div>
                                <span class="font-medium text-gray-300">
                                    {address}
                                </span>
                            </li>
                        )
                    }
                </ul>
            </div>

            {/* COLUMNA 4: ÁREAS DE SERVICIO (Span 4) */}
            <div class="md:col-span-4">
                <div
                    class="text-white font-bold mb-8 uppercase tracking-widest text-sm"
                >
                    Zonas de Servicio
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-3">
                    <ServiceAreas slim={true} />
                </div>
            </div>
        </div>

        {/* BARRA INFERIOR DIVISORA */}
        <div class="border-t border-white/5 pt-10 text-center">
            {/* LIKNS LEGALES */}
            <div
                class="flex flex-wrap justify-center items-center gap-x-4 gap-y-2 mb-6 text-[11px] uppercase tracking-widest text-gray-500 font-medium"
            >
                {
                    footerLinks.map((link, index) => (
                        <>
                            <a
                                href={link.url}
                                id={
                                    link.url === "#open-cookie-settings"
                                        ? "open-cookie-settings"
                                        : undefined
                                }
                                class="hover:text-primary transition-colors"
                            >
                                {link.label}
                            </a>
                            {index < footerLinks.length - 1 && (
                                <span class="text-white/10 hidden sm:inline">
                                    |
                                </span>
                            )}
                        </>
                    ))
                }
            </div>

            {/* COPYRIGHT */}
            <p class="text-gray-600 text-[11px] mb-4">
                &copy; {new Date().getFullYear()}
                <span class="text-gray-400 font-bold">{siteName}</span>. Todos
                los derechos reservados.
            </p>

            {/* DISCLAIMER / INTERMEDIARIO */}
            {
                disclaimer && (
                    <p class="text-gray-700 text-[10px] max-w-3xl mx-auto leading-relaxed uppercase tracking-wider font-light">
                        {disclaimer}
                    </p>
                )
            }
        </div>
    </div>
</footer>
